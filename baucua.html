<!-- <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyDezhyeDURAA_WfX8xxhGJ7KcNTVM8cwO4",
    authDomain: "tuankiet-gametet.firebaseapp.com",
    projectId: "tuankiet-gametet",
    storageBucket: "tuankiet-gametet.firebasestorage.app",
    messagingSenderId: "406766414133",
    appId: "1:406766414133:web:e4a99221da90dcc657847c",
    measurementId: "G-KJT59Z8FCK"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script> -->


<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫ßu Cua Online Realtime</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { font-family: sans-serif; background: #b71c1c; color: #333; text-align: center; margin: 0; padding: 10px; }
        .screen { display: none; max-width: 500px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .active { display: block; }
        input, button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; }
        button { background: #ffeb3b; color: #d32f2f; font-weight: bold; border: none; cursor: pointer; }
        .dice-box { display: flex; justify-content: center; gap: 10px; margin: 20px 0; background: #eee; padding: 10px; border-radius: 10px; }
        .dice { width: 60px; height: 60px; font-size: 2.5rem; display: flex; align-items: center; justify-content: center; background: white; border-radius: 5px; }
        .board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .bet-item { border: 1px solid #ddd; padding: 10px; border-radius: 5px; cursor: pointer; position: relative; }
        .bet-item.selected { background: #e3f2fd; border-color: #2196f3; }
        .my-bet { position: absolute; top: 0; right: 0; background: #d32f2f; color: white; padding: 2px 6px; font-size: 0.8rem; border-radius: 0 5px 0 5px; }
        .total-bet { display: block; font-size: 0.8rem; color: #666; margin-top: 5px; }
        .shaking { animation: shake 0.5s infinite; }
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }
        .user-info { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 15px; color: #d32f2f; }
        #log { font-size: 0.8rem; color: #666; height: 30px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="loginScreen" class="screen active">
        <h1>B·∫¶U CUA ONLINE</h1>
        <input type="text" id="username" placeholder="T√™n c·ªßa b·∫°n (VD: T√≠)">
        <input type="text" id="roomName" placeholder="T√™n ph√≤ng (VD: 1234)">
        <button onclick="joinGame()">V√ÄO PH√íNG NGAY</button>
    </div>

    <div id="gameScreen" class="screen">
        <div class="user-info">
            <span id="displayName"></span>
            <span>V·ªën: <span id="displayBalance">0</span>$</span>
        </div>
        
        <div id="log">ƒêang ƒë·ª£i c√°i...</div>

        <div class="dice-box">
            <div class="dice" id="d1">‚ùì</div>
            <div class="dice" id="d2">‚ùì</div>
            <div class="dice" id="d3">‚ùì</div>
        </div>

        <button id="shakeBtn" onclick="requestShake()">X√ìC ƒêƒ®A (T·∫•t c·∫£ c√πng th·∫•y)</button>
        <button onclick="resetGame()" style="background: #eee; color: #333; margin-top: 5px; font-size: 0.8rem;">V√°n m·ªõi (Reset c∆∞·ª£c)</button>

        <div class="board" id="board"></div>
    </div>

    <script>
        // --- 1. C·∫§U H√åNH FIREBASE (B·∫†N PH·∫¢I THAY ƒê·ªîI ƒêO·∫†N N√ÄY) ---
        // Copy t·ª´ Firebase Console -> Project Settings -> General -> Your apps
        const firebaseConfig = {
    apiKey: "AIzaSyDezhyeDURAA_WfX8xxhGJ7KcNTVM8cwO4",
    authDomain: "tuankiet-gametet.firebaseapp.com",
    projectId: "tuankiet-gametet",
    storageBucket: "tuankiet-gametet.firebasestorage.app",
    messagingSenderId: "406766414133",
    appId: "1:406766414133:web:e4a99221da90dcc657847c",
    measurementId: "G-KJT59Z8FCK"
  };
        // -----------------------------------------------------------
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // D·ªØ li·ªáu Game
        const mascots = [
            {id: 'nai', i:'ü¶å', n:'Nai'}, {id: 'bau', i:'ü•í', n:'B·∫ßu'}, 
            {id: 'ga', i:'üêî', n:'G√†'}, {id: 'ca', i:'üêü', n:'C√°'}, 
            {id: 'cua', i:'ü¶Ä', n:'Cua'}, {id: 'tom', i:'ü¶ê', n:'T√¥m'}
        ];
        
        let myName = '';
        let roomId = '';
        let myBalance = 1000;
        let myBets = {};
        let isShaking = false;

        // --- LOGIC GIAO DI·ªÜN ---
        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            mascots.forEach(m => {
                myBets[m.id] = 0;
                board.innerHTML += `
                    <div class="bet-item" onclick="placeBet('${m.id}')">
                        <div style="font-size:2rem">${m.i}</div>
                        <div>${m.n}</div>
                        <span class="my-bet" id="my-bet-${m.id}" style="display:none">0</span>
                        <span class="total-bet" id="total-bet-${m.id}">T·ªïng: 0$</span>
                    </div>
                `;
            });
        }

        function joinGame() {
            const u = document.getElementById('username').value.trim();
            const r = document.getElementById('roomName').value.trim();
            if(!u || !r) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin");
            
            myName = u;
            roomId = r;
            
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('displayName').innerText = myName;
            document.getElementById('displayBalance').innerText = myBalance;
            
            initBoard();
            listenToRoom();
        }

        // --- LOGIC M·∫†NG (FIREBASE) ---
        function listenToRoom() {
            const roomRef = db.ref('rooms/' + roomId);

            // 1. Nghe tr·∫°ng th√°i X√∫c x·∫Øc
            roomRef.child('diceStatus').on('value', (snapshot) => {
                const status = snapshot.val(); 
                // status d·∫°ng: { shaking: boolean, result: [0,1,2] }
                if(!status) return;

                const diceEls = [document.getElementById('d1'), document.getElementById('d2'), document.getElementById('d3')];
                
                if (status.shaking) {
                    document.getElementById('log').innerText = "Nh√† c√°i ƒëang x√≥c...";
                    diceEls.forEach(d => {
                        d.classList.add('shaking');
                        d.innerText = 'üé≤';
                    });
                    isShaking = true;
                } else if (status.result) {
                    diceEls.forEach((d, i) => {
                        d.classList.remove('shaking');
                        const mascotIndex = status.result[i];
                        if (mascotIndex !== undefined) d.innerText = mascots[mascotIndex].i;
                    });
                    
                    if (isShaking) { // Ch·ªâ t√≠nh ti·ªÅn khi v·ª´a chuy·ªÉn t·ª´ tr·∫°ng th√°i ƒëang x√≥c sang c√≥ k·∫øt qu·∫£
                        calculateResult(status.result);
                        isShaking = false;
                    }
                }
            });

            // 2. Nghe t·ªïng ti·ªÅn c∆∞·ª£c (C·ªßa t·∫•t c·∫£ m·ªçi ng∆∞·ªùi)
            roomRef.child('bets').on('value', (snapshot) => {
                const allBets = snapshot.val() || {};
                // allBets d·∫°ng: { nai: 100, bau: 20 ... }
                mascots.forEach(m => {
                    const total = allBets[m.id] || 0;
                    document.getElementById(`total-bet-${m.id}`).innerText = `T·ªïng: ${total}$`;
                });
            });
        }

        // ƒê·∫∑t c∆∞·ª£c
        function placeBet(mascotId) {
            if (isShaking) return alert("ƒêang x√≥c, kh√¥ng ƒë∆∞·ª£c c∆∞·ª£c!");
            if (myBalance < 10) return alert("H·∫øt ti·ªÅn r·ªìi!");

            // Tr·ª´ ti·ªÅn c·ª•c b·ªô
            myBalance -= 10;
            myBets[mascotId] += 10;
            updateMyUI();

            // G·ª≠i l√™n server (c·ªông d·ªìn v√†o t·ªïng c∆∞·ª£c chung c·ªßa ph√≤ng)
            const betRef = db.ref(`rooms/${roomId}/bets/${mascotId}`);
            betRef.transaction((current_value) => {
                return (current_value || 0) + 10;
            });
        }

        function updateMyUI() {
            document.getElementById('displayBalance').innerText = myBalance;
            mascots.forEach(m => {
                const el = document.getElementById(`my-bet-${m.id}`);
                if (myBets[m.id] > 0) {
                    el.style.display = 'block';
                    el.innerText = myBets[m.id];
                } else {
                    el.style.display = 'none';
                }
            });
        }

        // X√≥c (G·ª≠i l·ªánh l√™n server)
        function requestShake() {
            // Set tr·∫°ng th√°i ƒëang rung
            db.ref(`rooms/${roomId}/diceStatus`).set({ shaking: true });

            // Sau 2 gi√¢y th√¨ random k·∫øt qu·∫£ v√† g·ª≠i l√™n
            setTimeout(() => {
                const r1 = Math.floor(Math.random() * 6);
                const r2 = Math.floor(Math.random() * 6);
                const r3 = Math.floor(Math.random() * 6);
                
                db.ref(`rooms/${roomId}/diceStatus`).set({
                    shaking: false,
                    result: [r1, r2, r3]
                });
            }, 2000);
        }
        
        // T√≠nh ti·ªÅn (Ch·∫°y ·ªü m·ªói m√°y tr·∫°m khi c√≥ k·∫øt qu·∫£ tr·∫£ v·ªÅ)
        function calculateResult(resultIndices) {
            let winAmount = 0;
            // Danh s√°ch c√°c ID con v·∫≠t tr√∫ng
            const winningIds = resultIndices.map(i => mascots[i].id);
            
            mascots.forEach(m => {
                const myBetOnThis = myBets[m.id];
                if (myBetOnThis > 0) {
                    const count = winningIds.filter(id => id === m.id).length;
                    if (count > 0) {
                        winAmount += myBetOnThis; // Tr·∫£ g·ªëc
                        winAmount += myBetOnThis * count; // ƒÇn l√£i
                    }
                }
            });

            if (winAmount > 0) {
                myBalance += winAmount;
                document.getElementById('log').innerText = `Ch√∫c m·ª´ng! B·∫°n th·∫Øng ${winAmount}$`;
                updateMyUI();
            } else {
                document.getElementById('log').innerText = "Thua r·ªìi!";
            }
        }

        function resetGame() {
            // X√≥a c∆∞·ª£c c√° nh√¢n
            mascots.forEach(m => myBets[m.id] = 0);
            updateMyUI();
            document.getElementById('log').innerText = "ƒê√£ s·∫µn s√†ng v√°n m·ªõi";
            
            // X√≥a t·ªïng c∆∞·ª£c tr√™n server (Ch·ªâ c·∫ßn 1 ng∆∞·ªùi l√†m)
             db.ref(`rooms/${roomId}/bets`).set(null);
        }

    </script>
</body>
</html>